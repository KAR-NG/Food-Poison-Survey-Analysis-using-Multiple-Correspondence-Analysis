---
title: "poison_survey"
author: "Kar"
date: '2022-05-05'
output: 
  github_document: 
    toc: true
    toc_depth: 4
always_allow_html: yes
---


## 1 SUMMARY

## 2 R PACKAGES

```{r, message=FALSE, warning=FALSE}

library(tidyverse)
library(skimr)
library(tidytext)
library(cowplot)
library(factoextra)
library(FactoMineR)

```


## 3 INTRODUCTION

This project will analyse a survey dataset using one of the principal component methods. The technique of "Principal component methods" is known as one of the machine learning methods, belonging to the "unsupervised" branch, which can quickly summarise a dataset by revealing the most important variables (columns) or observations (rows) in the dataset. 

The data of this survey dataset was collected from students in a primary school who suffered from food poisoning. The dataset contains various type of information such as age, time, whether the student is sicked, sex, symptoms of food poisoning (nausea, vomiting, abdominal, fever, and diarrhea) and food they ate (potato, fish, mayo, courgette, cheese, ice cream).





## 4 DATA PREPARATION

The dataset of this project is called "poison", which is a public dataset from the R package "FactoMineR".

### 4.1 Data Import

Following code download the dataset from the package.

```{r}
data(poison)

```

Randomly sample 10 rows within the dataset:

```{r}
sample_n(poison, 10)

```

### 4.2 Data Exploration

The dataset has 55 rows (55 students) and 15 columns recording the various type of variables (also known as feature).

Following code also shows the variable type allocated by R to each of the column. 

```{r}
glimpse(poison)

```

Factor "fct" is a variable type we usually allocate to variables that have categorisation nature. There is usually a conversion step required to perform by analyst to convert character "chr" variable such as "Yes" and "No" into factor "fct". This step seems like has been completed.

Insights from following summary, 

* Respondents have age between 4 to 88, with majority of them fall between 6 to 10 years old with a median of 8. Mean of 16.93 shouldn't be used for reference because 88 is a outlier.   
* Time should be time of recording the data.   
* The rest of the variables have two categories of either "Yes" or "No".  

```{r}
summary(poison)

```
Following is an alternative to see the structure of the dataset. Other than Age and time, the rest of the variables are factor type with 2 levels, of either "Y" or "No", which stand for "Yes" or "No". 

```{r}
str(poison)

```

Checking missing data in the dataset, there is no missing data deteccted by examining the column "n_missing" and "complete_rate" in following tables. This special summary also summarise that there are 13 factor variables and 2 numerical variables. 

```{r}
skim_without_charts(poison)

```
Alternatively, using following code to check missing data in the dataset.

```{r}
colSums(is.na(poison))

```

There is no missing data in the dataset. 


## 5 EDA

EDA stands for Exploratory data analysis, which is using graphical methods to explore the data, to find and understand trends. 

### 5.1 Age and Time

```{r, message=FALSE}

# df

df5.2 <- poison %>% 
  dplyr::select("Age", "Time") %>% 
  pivot_longer(c(1:2), names_to = "var", values_to = "val") %>% 
  mutate(var = as.factor(var),
         val = as.factor(val)) %>% 
  group_by(var, val) %>% 
  summarise(count = n()) %>% 
  ungroup()
  
df5.2

# graph

ggplot(df5.2, aes(x = val, y = count, fill = var)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = count), vjust = -0.2) +
  facet_wrap(~var, scale = "free") +
  theme_bw() +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5)) +
  labs(title = "The distribution of Age and Time",
       subtitle = "by Histogram",
       x = "Value",
       y = "Head Count")

```
From above graph, I can figure that students participated in the survey were between 5 to 11 years old. The 4 years old child might be a visitor brought by one of the adults between 36 to 88 years old. These adults might be visitors or teachers. The identity of these adults are not important, as well as the variable "Time" because I am more focus on what food cause the food poisoning.  


### 5.2 Dashboard

There are 13 variables left to visualise, I will now create a static dashboard to view all of these variables at once. 

```{r, message=FALSE, fig.height=8, fig.width=9}
# set data frames

info <- poison %>% dplyr::select(Sick, Sex)
symptom <- poison %>% dplyr::select(Sick, Nausea, Vomiting, Abdominals, Fever, Diarrhae) 
food <- poison %>% dplyr::select(c(Sick, 10:15)) 

# graph for info

graph_info <- info %>% 
  pivot_longer(c(1:2), names_to = "var", values_to = "val") %>% 
  mutate(var = as.factor(var),
         val = as.factor(val)) %>% 
  group_by(var, val) %>% 
  summarise(count = n()) %>% 
  ungroup() %>% 
  ggplot(aes(x = val, y = count)) +
  geom_bar(stat = "identity", color = "black", fill = "purple") +
  geom_text(aes(label = count), vjust = 1.5, color = "white") +
  facet_wrap(~var, scale = "free") +
  theme_bw() +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5)) +
  labs(x = "", 
       y = "Head Count",
       title = "Status")


## graph for symptom

graph_symptom <- symptom %>% 
  pivot_longer(c(2:6), names_to = "var", values_to = "val") %>% 
  mutate(var = as.factor(var),
         val = as.factor(val)) %>% 
  group_by(Sick, var, val) %>% 
  summarise(count = n()) %>% 
  ungroup() %>%   
  ggplot(aes(x = val, y = count, fill = Sick)) +
  geom_bar(stat = "identity",
           position = "dodge",
           color = "black") +
  geom_label(aes(label = count), color = "black",
            position = position_dodge(width = 0.9)) +
  facet_wrap(~var, scale = "free_x", nrow = 1) +
  theme_bw() +
  theme(legend.position = "top",
        plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.2)) +
  labs(x = "",
       y = "",
       title = "Symptoms")

## graph for food

graph_food <- food %>% 
  pivot_longer(c(2:7), names_to = "var", values_to = "val") %>% 
  mutate(var = as.factor(var),
         val = as.factor(val)) %>% 
  group_by(Sick, var, val) %>% 
  summarise(count = n()) %>% 
  ungroup() %>% 
  ggplot(aes(y = val, x = count, fill = Sick)) +
  geom_bar(stat = "identity", color = "black",
           position = "dodge") +
  geom_label(aes(label = count), hjust = 0.8,
             position = position_dodge(width = 0.9)) +
  facet_wrap(~var, scale = "free_y") +
  theme_bw() +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5)) +
  labs(y = "",
       x = "Head Count",
       title = "Food Ate")

# Dashboard

title <- ggdraw() + draw_label("Food Poisoning Dataset Analysis", fontface = "bold", size = 20)

top_row <- plot_grid(graph_info, graph_symptom,
                     rel_widths = c(1, 2.5))

plot_grid(title, top_row, graph_food, 
          ncol = 1,
          rel_heights = c(0.2, 1.2, 1))

```

**Insights**

* 38 persons out of 55 were sick.  

* Almost all of the responds who suffered from food poisoning experience abdominals, diarrhea, and fever. 20% of them suffered from nausea and 40% suffered from vomiting. 

Almost all sicked persons (green) ate all the food mentioned in the graph. However, there were many healthy persons also ate these food. It can be difficult to estimate which food cause food poisoning. 


## PRINCIPAL COMPONENT METHODS

Applying Principal component methods to find the relationship. I will be using multiple 



## REFERENCE

KASSAMBARA A 2017, *Practical Guide To Principal Component Methods in R*, Edition 1, sthda.com